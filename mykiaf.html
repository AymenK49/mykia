<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kia Rio - Suivi d'Entretien</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap');
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }
        .sidebar {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 50;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .nav-item.active {
            background-color: #eff6ff;
            border-right: 3px solid #3b82f6;
            color: #3b82f6;
        }
        .reminder-card {
            border-left-width: 4px;
        }
        .mobile-menu-button {
            display: none;
        }
        .sidebar-mobile {
            display: none;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .sidebar-mobile {
                display: block;
            }
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            .mobile-menu-button {
                display: block;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .history-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) {
            .main-content {
                margin-left: 16rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { motion, AnimatePresence } = window.FramerMotion || { motion: 'div', AnimatePresence: ({children}) => children };

        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');
            const [currentKilometrage, setCurrentKilometrage] = useState(0);
            const [entretiens, setEntretiens] = useState([]);

            const [formData, setFormData] = useState({
                type: 'vidange',
                date: '',
                kilometrage: '',
                cout: '',
                garage: '',
                details: {
                    marque: '',
                    viscosite: '',
                    filtreAir: false,
                    filtreHuile: false
                },
                notes: ''
            });

            const [searchTerm, setSearchTerm] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [sidebarOpen, setSidebarOpen] = useState(false);

            // Charger les données depuis localStorage au démarrage
            useEffect(() => {
                const savedKilometrage = localStorage.getItem('kiaRioKilometrage');
                const savedEntretiens = localStorage.getItem('kiaRioEntretiens');
                
                if (savedKilometrage) {
                    setCurrentKilometrage(parseInt(savedKilometrage));
                }
                
                if (savedEntretiens) {
                    try {
                        setEntretiens(JSON.parse(savedEntretiens));
                    } catch (error) {
                        console.error('Erreur lors du chargement des entretiens:', error);
                        setEntretiens([]);
                    }
                }
            }, []);

            // Sauvegarder les données dans localStorage quand elles changent
            useEffect(() => {
                localStorage.setItem('kiaRioKilometrage', currentKilometrage.toString());
            }, [currentKilometrage]);

            useEffect(() => {
                localStorage.setItem('kiaRioEntretiens', JSON.stringify(entretiens));
            }, [entretiens]);

            // Calculs pour le tableau de bord
            const totalEntretiens = entretiens.length;
            const coutTotal = entretiens.reduce((sum, entretien) => sum + entretien.cout, 0);
            const coutMoyen = totalEntretiens > 0 ? (coutTotal / totalEntretiens).toFixed(3) : 0;

            // Rappels - Vidange tous les 8000 km
            const rappels = entretiens.map(entretien => {
                const ecart = currentKilometrage - entretien.prochaineEcheance;
                let urgence = 'normal';
                let message = '';
                
                if (ecart >= 0) {
                    urgence = 'en-retard';
                    message = `En retard de ${Math.abs(ecart)} km`;
                } else if (ecart >= -1000) {
                    urgence = 'urgent';
                    message = `À faire dans ${Math.abs(ecart)} km`;
                } else if (ecart >= -3000) {
                    urgence = 'bientot';
                    message = `Prévoir dans ${Math.abs(ecart)} km`;
                }
                
                return { ...entretien, urgence, message };
            }).filter(rappel => rappel.urgence !== 'normal');

            // Ajouter rappel de vidange si aucun entretien n'existe
            const rappelsAffiches = [...rappels];
            if (entretiens.length === 0 && currentKilometrage > 0) {
                const nextVidange = 8000;
                const ecart = currentKilometrage - nextVidange;
                if (ecart >= -3000) {
                    let urgence = 'normal';
                    let message = '';
                    
                    if (ecart >= 0) {
                        urgence = 'en-retard';
                        message = `Vidange en retard de ${Math.abs(ecart)} km`;
                    } else if (ecart >= -1000) {
                        urgence = 'urgent';
                        message = `Vidange à faire dans ${Math.abs(ecart)} km`;
                    } else if (ecart >= -3000) {
                        urgence = 'bientot';
                        message = `Vidange prévoir dans ${Math.abs(ecart)} km`;
                    }
                    
                    rappelsAffiches.push({
                        id: 'reminder-vidange',
                        type: 'vidange',
                        prochaineEcheance: nextVidange,
                        urgence,
                        message
                    });
                }
            }

            const entretiensFiltres = entretiens.filter(entretien => {
                const matchesSearch = entretien.type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     entretien.garage.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesFilter = filterType === 'all' || entretien.type === filterType;
                return matchesSearch && matchesFilter;
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Définir l'intervalle en fonction du type d'entretien
                let intervalle = 8000; // par défaut pour vidange
                switch(formData.type) {
                    case 'vidange':
                        intervalle = 8000;
                        break;
                    case 'freins':
                        intervalle = 20000;
                        break;
                    case 'pneus':
                        intervalle = 100000;
                        break;
                    case 'filtres':
                        intervalle = 20000;
                        break;
                    case 'courroie':
                        intervalle = 20000;
                        break;
                    case 'bougies':
                        intervalle = 90000;
                        break;
                }
                
                const newEntretien = {
                    id: Date.now(),
                    ...formData,
                    kilometrage: parseInt(formData.kilometrage),
                    cout: parseFloat(formData.cout),
                    prochaineEcheance: parseInt(formData.kilometrage) + intervalle
                };
                setEntretiens([...entretiens, newEntretien]);
                setFormData({
                    type: 'vidange',
                    date: '',
                    kilometrage: '',
                    cout: '',
                    garage: '',
                    details: {
                        marque: '',
                        viscosite: '',
                        filtreAir: false,
                        filtreHuile: false
                    },
                    notes: ''
                });
                setCurrentView('dashboard');
                setSidebarOpen(false);
            };

            const getTypeIcon = (type) => {
                switch(type) {
                    case 'vidange': return 'fa-oil-can';
                    case 'freins': return 'fa-brake';
                    case 'pneus': return 'fa-tire';
                    case 'bougies': return 'fa-bolt';
                    default: return 'fa-wrench';
                }
            };

            const getTypeColor = (type) => {
                switch(type) {
                    case 'vidange': return 'bg-blue-500';
                    case 'freins': return 'bg-red-500';
                    case 'pneus': return 'bg-green-500';
                    case 'bougies': return 'bg-yellow-500';
                    default: return 'bg-gray-500';
                }
            };

            const getUrgenceColor = (urgence) => {
                switch(urgence) {
                    case 'en-retard': return 'border-l-red-500 bg-red-50';
                    case 'urgent': return 'border-l-orange-500 bg-orange-50';
                    case 'bientot': return 'border-l-yellow-500 bg-yellow-50';
                    default: return 'border-l-gray-300 bg-gray-50';
                }
            };

            const getTypeLabel = (type) => {
                switch(type) {
                    case 'vidange': return 'Vidange';
                    case 'freins': return 'Freins';
                    case 'pneus': return 'Pneus';
                    case 'filtres': return 'Filtres';
                    case 'courroie': return 'Courroie';
                    case 'bougies': return 'Bougies';
                    default: return type;
                }
            };

            // Fonction pour formater les montants en TND
            const formatTND = (amount) => {
                return new Intl.NumberFormat('fr-TN', {
                    style: 'currency',
                    currency: 'TND',
                    minimumFractionDigits: 3,
                    maximumFractionDigits: 3
                }).format(amount);
            };

            // Fonction pour exporter les données
            const exportData = () => {
                const data = {
                    entretiens: entretiens,
                    kilometrage: currentKilometrage,
                    dateExport: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `entretiens-kia-rio-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            // Fonction pour importer les données
            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.entretiens && Array.isArray(data.entretiens)) {
                                setEntretiens(data.entretiens);
                            }
                            if (typeof data.kilometrage === 'number') {
                                setCurrentKilometrage(data.kilometrage);
                            }
                            alert('Données importées avec succès!');
                        } catch (error) {
                            alert('Fichier invalide. Veuillez sélectionner un fichier JSON valide.');
                        }
                    };
                    reader.readAsText(file);
                }
                // Réinitialiser l'input file
                event.target.value = '';
            };

            const menuItems = [
                { id: 'dashboard', label: 'Tableau de bord', icon: 'fa-chart-line' },
                { id: 'ajout', label: 'Ajouter entretien', icon: 'fa-plus' },
                { id: 'historique', label: 'Historique', icon: 'fa-history' }
            ];

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Mobile menu button */}
                    <div className="mobile-menu-button fixed top-4 left-4 z-40">
                        <button
                            onClick={() => setSidebarOpen(!sidebarOpen)}
                            className="bg-white p-3 rounded-lg shadow-lg"
                        >
                            <i className="fas fa-bars text-gray-600"></i>
                        </button>
                    </div>

                    {/* Navigation latérale - Desktop */}
                    <div className="sidebar fixed left-0 top-0 h-full w-64 bg-white hidden md:block">
                        <div className="p-6 border-b">
                            <div className="flex items-center space-x-3">
                                <i className="fas fa-car text-blue-600 text-2xl"></i>
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800">Kia Rio</h1>
                                    <p className="text-sm text-gray-500">Suivi d'entretien</p>
                                </div>
                            </div>
                        </div>
                        
                        <nav className="mt-6">
                            {menuItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => {
                                        setCurrentView(item.id);
                                        setSidebarOpen(false);
                                    }}
                                    className={`w-full flex items-center space-x-3 px-6 py-3 text-left transition-colors nav-item ${
                                        currentView === item.id ? 'active' : 'text-gray-600 hover:bg-gray-50'
                                    }`}
                                >
                                    <i className={`fas ${item.icon} w-5 h-5`}></i>
                                    <span>{item.label}</span>
                                </button>
                            ))}
                            
                            {/* Boutons d'export/import */}
                            <div className="px-6 py-4 border-t mt-4">
                                <button
                                    onClick={exportData}
                                    className="w-full flex items-center space-x-2 px-4 py-2 text-left text-sm text-gray-600 hover:bg-gray-50 rounded"
                                >
                                    <i className="fas fa-download"></i>
                                    <span>Exporter données</span>
                                </button>
                                
                                <label className="w-full flex items-center space-x-2 px-4 py-2 text-left text-sm text-gray-600 hover:bg-gray-50 rounded cursor-pointer mt-2">
                                    <i className="fas fa-upload"></i>
                                    <span>Importer données</span>
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="hidden"
                                    />
                                </label>
                            </div>
                        </nav>
                    </div>

                    {/* Navigation latérale - Mobile */}
                    {sidebarOpen && (
                        <div className="sidebar-mobile fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden">
                            <div className="bg-white w-64 h-full">
                                <div className="p-6 border-b">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center space-x-3">
                                            <i className="fas fa-car text-blue-600 text-2xl"></i>
                                            <div>
                                                <h1 className="text-xl font-bold text-gray-800">Kia Rio</h1>
                                                <p className="text-sm text-gray-500">Suivi d'entretien</p>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => setSidebarOpen(false)}
                                            className="text-gray-500"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <nav className="mt-6">
                                    {menuItems.map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => {
                                                setCurrentView(item.id);
                                                setSidebarOpen(false);
                                            }}
                                            className={`w-full flex items-center space-x-3 px-6 py-3 text-left transition-colors nav-item ${
                                                currentView === item.id ? 'active' : 'text-gray-600 hover:bg-gray-50'
                                            }`}
                                        >
                                            <i className={`fas ${item.icon} w-5 h-5`}></i>
                                            <span>{item.label}</span>
                                        </button>
                                    ))}
                                    
                                    {/* Boutons d'export/import mobile */}
                                    <div className="px-6 py-4 border-t mt-4">
                                        <button
                                            onClick={() => {
                                                exportData();
                                                setSidebarOpen(false);
                                            }}
                                            className="w-full flex items-center space-x-2 px-4 py-2 text-left text-sm text-gray-600 hover:bg-gray-50 rounded"
                                        >
                                            <i className="fas fa-download"></i>
                                            <span>Exporter données</span>
                                        </button>
                                        
                                        <label className="w-full flex items-center space-x-2 px-4 py-2 text-left text-sm text-gray-600 hover:bg-gray-50 rounded cursor-pointer mt-2">
                                            <i className="fas fa-upload"></i>
                                            <span>Importer données</span>
                                            <input
                                                type="file"
                                                accept=".json"
                                                onChange={(e) => {
                                                    importData(e);
                                                    setSidebarOpen(false);
                                                }}
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    )}

                    {/* Contenu principal */}
                    <div className="main-content p-4 md:p-8 pt-20 md:pt-8">
                        <AnimatePresence mode="wait">
                            {currentView === 'dashboard' && (
                                <div key="dashboard" className="animate-fade-in">
                                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Tableau de bord</h2>
                                    
                                    {/* Mise à jour kilométrage */}
                                    <div className="bg-white rounded-lg card p-4 md:p-6 mb-6">
                                        <h3 className="text-lg font-semibold mb-4">Kilométrage actuel</h3>
                                        <div className="flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-4">
                                            <input
                                                type="number"
                                                value={currentKilometrage}
                                                onChange={(e) => setCurrentKilometrage(parseInt(e.target.value) || 0)}
                                                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full"
                                                placeholder="Kilométrage"
                                            />
                                            <span className="text-xl md:text-2xl font-bold text-blue-600">{currentKilometrage.toLocaleString()} km</span>
                                        </div>
                                    </div>

                                    {/* Statistiques */}
                                    <div className="stats-grid grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6">
                                        <div className="bg-white rounded-lg card p-4 md:p-6 hover:shadow-lg transition-shadow">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-gray-500">Nombre d'entretiens</p>
                                                    <p className="text-2xl md:text-3xl font-bold text-gray-800">{totalEntretiens}</p>
                                                </div>
                                                <i className="fas fa-wrench text-blue-500 text-xl md:text-2xl"></i>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-white rounded-lg card p-4 md:p-6 hover:shadow-lg transition-shadow">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-gray-500">Coût total</p>
                                                    <p className="text-2xl md:text-3xl font-bold text-green-600">{formatTND(coutTotal)}</p>
                                                </div>
                                                <i className="fas fa-money-bill-wave text-green-500 text-xl md:text-2xl"></i>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-white rounded-lg card p-4 md:p-6 hover:shadow-lg transition-shadow">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="text-sm text-gray-500">Coût moyen</p>
                                                    <p className="text-2xl md:text-3xl font-bold text-purple-600">{formatTND(parseFloat(coutMoyen))}</p>
                                                </div>
                                                <i className="fas fa-chart-trending-up text-purple-500 text-xl md:text-2xl"></i>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Rappels */}
                                    <div className="mb-6">
                                        <h3 className="text-lg md:text-xl font-semibold mb-4">Rappels importants</h3>
                                        {rappelsAffiches.length > 0 ? (
                                            <div className="space-y-3 md:space-y-4">
                                                {rappelsAffiches.map(rappel => (
                                                    <div
                                                        key={rappel.id}
                                                        className={`border-l-4 rounded-lg p-3 md:p-4 reminder-card ${getUrgenceColor(rappel.urgence)}`}
                                                    >
                                                        <div className="flex flex-col md:flex-row md:items-center justify-between space-y-2 md:space-y-0">
                                                            <div className="flex items-center space-x-3">
                                                                <div className={`p-2 rounded-full ${getTypeColor(rappel.type)} text-white`}>
                                                                    <i className={`fas ${getTypeIcon(rappel.type)}`}></i>
                                                                </div>
                                                                <div>
                                                                    <p className="font-semibold capitalize text-sm md:text-base">{getTypeLabel(rappel.type)}</p>
                                                                    <p className="text-xs md:text-sm text-gray-600">{rappel.message}</p>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <p className="text-xs text-gray-500">Échéance</p>
                                                                <p className="font-semibold text-sm md:text-base">{rappel.prochaineEcheance.toLocaleString()} km</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="bg-white rounded-lg card p-6 md:p-8 text-center">
                                                <i className="fas fa-check-circle text-green-500 text-3xl md:text-4xl mx-auto mb-3"></i>
                                                <p className="text-gray-600 text-sm md:text-base">Aucun rappel urgent pour le moment</p>
                                                <p className="text-gray-500 text-xs mt-2">Ajoutez des entretiens pour commencer à recevoir des rappels</p>
                                            </div>
                                        )}
                                    </div>

                                    {/* Entretiens récents */}
                                    <div>
                                        <h3 className="text-lg md:text-xl font-semibold mb-4">Entretiens récents</h3>
                                        {entretiens.length > 0 ? (
                                            <div className="bg-white rounded-lg card overflow-hidden">
                                                <div className="divide-y">
                                                    {entretiens.slice(0, 3).map(entretien => (
                                                        <div key={entretien.id} className="p-3 md:p-4 hover:bg-gray-50 transition-colors">
                                                            <div className="flex flex-col md:flex-row md:items-center justify-between space-y-2 md:space-y-0">
                                                                <div className="flex items-center space-x-3">
                                                                    <div className={`p-2 rounded-full ${getTypeColor(entretien.type)} text-white`}>
                                                                        <i className={`fas ${getTypeIcon(entretien.type)}`}></i>
                                                                    </div>
                                                                    <div>
                                                                        <p className="font-semibold capitalize text-sm md:text-base">{getTypeLabel(entretien.type)}</p>
                                                                        <p className="text-xs text-gray-500">{entretien.date} • {entretien.garage}</p>
                                                                    </div>
                                                                </div>
                                                                <div className="text-right">
                                                                    <p className="font-semibold text-green-600 text-sm md:text-base">{formatTND(entretien.cout)}</p>
                                                                    <p className="text-xs text-gray-500">{entretien.kilometrage.toLocaleString()} km</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="bg-white rounded-lg card p-8 md:p-12 text-center">
                                                <i className="fas fa-tools text-gray-400 text-3xl md:text-4xl mx-auto mb-3"></i>
                                                <p className="text-gray-600 text-sm md:text-base">Aucun entretien enregistré</p>
                                                <p className="text-gray-500 text-xs mt-2">Commencez par ajouter votre premier entretien</p>
                                                <button
                                                    onClick={() => setCurrentView('ajout')}
                                                    className="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                                >
                                                    Ajouter un entretien
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {currentView === 'ajout' && (
                                <div key="ajout" className="animate-fade-in">
                                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Ajouter un entretien</h2>
                                    
                                    <div className="bg-white rounded-lg card p-4 md:p-6">
                                        <form onSubmit={handleSubmit} className="space-y-4 md:space-y-6">
                                            <div className="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Type d'entretien</label>
                                                    <select
                                                        value={formData.type}
                                                        onChange={(e) => setFormData({...formData, type: e.target.value})}
                                                        className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    >
                                                        <option value="vidange">Vidange (8000 km)</option>
                                                        <option value="freins">Freins (20000 km)</option>
                                                        <option value="pneus">Pneus (100000 km)</option>
                                                        <option value="filtres">Filtres (20000 km)</option>
                                                        <option value="courroie">Courroie de distribution (20000 km)</option>
                                                        <option value="bougies">Bougies (90000 km)</option>
                                                    </select>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                                    <input
                                                        type="date"
                                                        value={formData.date}
                                                        onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                        className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Kilométrage</label>
                                                    <input
                                                        type="number"
                                                        value={formData.kilometrage}
                                                        onChange={(e) => setFormData({...formData, kilometrage: e.target.value})}
                                                        className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="Kilométrage"
                                                        required
                                                    />
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Coût (TND)</label>
                                                    <input
                                                        type="number"
                                                        step="0.001"
                                                        value={formData.cout}
                                                        onChange={(e) => setFormData({...formData, cout: e.target.value})}
                                                        className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="Coût"
                                                        required
                                                    />
                                                </div>
                                                
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Garage</label>
                                                    <input
                                                        type="text"
                                                        value={formData.garage}
                                                        onChange={(e) => setFormData({...formData, garage: e.target.value})}
                                                        className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="Nom du garage"
                                                        required
                                                    />
                                                </div>
                                            </div>

                                            {/* Section spécifique pour les vidanges */}
                                            {formData.type === 'vidange' && (
                                                <div className="border-t pt-4 md:pt-6 animate-fade-in">
                                                    <h4 className="text-lg font-semibold mb-3 md:mb-4">Détails de l'huile</h4>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 mb-4">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Marque d'huile</label>
                                                            <select
                                                                value={formData.details.marque}
                                                                onChange={(e) => setFormData({
                                                                    ...formData,
                                                                    details: {...formData.details, marque: e.target.value}
                                                                })}
                                                                className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                            >
                                                                <option value="">Sélectionner une marque</option>
                                                                <option value="Total">Total</option>
                                                                <option value="Shell">Shell</option>
                                                                <option value="Castrol">Castrol</option>
                                                                <option value="Mobil">Mobil</option>
                                                                <option value="Elf">Elf</option>
                                                                <option value="BP">BP</option>
                                                                <option value="Texaco">Texaco</option>
                                                                <option value="Liqui Moly">Liqui Moly</option>
                                                                <option value="Motul">Motul</option>
                                                                <option value="Valvoline">Valvoline</option>
                                                                <option value="Penrite">Penrite</option>
                                                                <option value="Gulf">Gulf</option>
                                                                <option value="Fuchs">Fuchs</option>
                                                                <option value="Other">Autre</option>
                                                            </select>
                                                        </div>
                                                        
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Viscosité</label>
                                                            <select
                                                                value={formData.details.viscosite}
                                                                onChange={(e) => setFormData({
                                                                    ...formData,
                                                                    details: {...formData.details, viscosite: e.target.value}
                                                                })}
                                                                className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                            >
                                                                <option value="">Sélectionner la viscosité</option>
                                                                <option value="0W-20">0W-20</option>
                                                                <option value="0W-30">0W-30</option>
                                                                <option value="0W-40">0W-40</option>
                                                                <option value="5W-20">5W-20</option>
                                                                <option value="5W-30">5W-30</option>
                                                                <option value="5W-40">5W-40</option>
                                                                <option value="10W-30">10W-30</option>
                                                                <option value="10W-40">10W-40</option>
                                                                <option value="15W-40">15W-40</option>
                                                                <option value="20W-50">20W-50</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                        <div className="flex items-center">
                                                            <input
                                                                type="checkbox"
                                                                id="filtreAir"
                                                                checked={formData.details.filtreAir}
                                                                onChange={(e) => setFormData({
                                                                    ...formData,
                                                                    details: {...formData.details, filtreAir: e.target.checked}
                                                                })}
                                                                className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                                            />
                                                            <label htmlFor="filtreAir" className="ml-2 block text-sm text-gray-700">
                                                                Filtre à air changé
                                                            </label>
                                                        </div>
                                                        
                                                        <div className="flex items-center">
                                                            <input
                                                                type="checkbox"
                                                                id="filtreHuile"
                                                                checked={formData.details.filtreHuile}
                                                                onChange={(e) => setFormData({
                                                                    ...formData,
                                                                    details: {...formData.details, filtreHuile: e.target.checked}
                                                                })}
                                                                className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                                            />
                                                            <label htmlFor="filtreHuile" className="ml-2 block text-sm text-gray-700">
                                                                Filtre à huile changé
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Notes et observations</label>
                                                <textarea
                                                    value={formData.notes}
                                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                                    rows={3}
                                                    className="w-full px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="Notes supplémentaires..."
                                                />
                                            </div>

                                            <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                                                <button
                                                    type="submit"
                                                    className="flex-1 bg-blue-600 text-white py-2 md:py-3 px-4 md:px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                                >
                                                    Ajouter l'entretien
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        setCurrentView('dashboard');
                                                        setSidebarOpen(false);
                                                    }}
                                                    className="px-4 py-2 md:px-6 md:py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                                                >
                                                    Annuler
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            )}

                            {currentView === 'historique' && (
                                <div key="historique" className="animate-fade-in">
                                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Historique des entretiens</h2>
                                    
                                    {/* Filtres et recherche */}
                                    <div className="bg-white rounded-lg card p-4 md:p-6 mb-6">
                                        <div className="flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-4">
                                            <div className="flex-1">
                                                <div className="relative">
                                                    <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"></i>
                                                    <input
                                                        type="text"
                                                        value={searchTerm}
                                                        onChange={(e) => setSearchTerm(e.target.value)}
                                                        placeholder="Rechercher par type ou garage..."
                                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                    />
                                                </div>
                                            </div>
                                            
                                            <div className="flex items-center space-x-2">
                                                <i className="fas fa-filter text-gray-500 text-sm"></i>
                                                <select
                                                    value={filterType}
                                                    onChange={(e) => setFilterType(e.target.value)}
                                                    className="px-3 py-2 md:px-4 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                >
                                                    <option value="all">Tous les types</option>
                                                    <option value="vidange">Vidange</option>
                                                    <option value="freins">Freins</option>
                                                    <option value="pneus">Pneus</option>
                                                    <option value="bougies">Bougies</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Liste des entretiens */}
                                    <div className="space-y-3 md:space-y-4">
                                        {entretiensFiltres.length > 0 ? (
                                            entretiensFiltres.map(entretien => (
                                                <div
                                                    key={entretien.id}
                                                    className="bg-white rounded-lg card p-4 md:p-6 animate-fade-in"
                                                >
                                                    <div className="flex flex-col">
                                                        <div className="flex items-start space-x-3 mb-3">
                                                            <div className={`p-2 md:p-3 rounded-full ${getTypeColor(entretien.type)} text-white`}>
                                                                <i className={`fas ${getTypeIcon(entretien.type)}`}></i>
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className="flex flex-wrap items-center space-x-2 mb-2">
                                                                    <h3 className="text-lg font-semibold capitalize">{getTypeLabel(entretien.type)}</h3>
                                                                    <span className="text-xs text-gray-500">•</span>
                                                                    <span className="text-xs text-gray-500">{entretien.date}</span>
                                                                </div>
                                                                
                                                                <div className="history-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-4">
                                                                    <div>
                                                                        <p className="text-xs text-gray-500">Kilométrage</p>
                                                                        <p className="font-medium text-sm">{entretien.kilometrage.toLocaleString()} km</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="text-xs text-gray-500">Coût</p>
                                                                        <p className="font-medium text-green-600 text-sm">{formatTND(entretien.cout)}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="text-xs text-gray-500">Garage</p>
                                                                        <p className="font-medium text-sm">{entretien.garage}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p className="text-xs text-gray-500">Prochaine échéance</p>
                                                                        <p className="font-medium text-sm">{entretien.prochaineEcheance.toLocaleString()} km</p>
                                                                    </div>
                                                                </div>

                                                                {/* Détails spécifiques */}
                                                                {entretien.type === 'vidange' && entretien.details && entretien.details.marque && (
                                                                    <div className="bg-blue-50 rounded-lg p-3 md:p-4 mb-3">
                                                                        <h4 className="font-medium text-blue-800 mb-2 text-sm">Détails de l'huile</h4>
                                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs mb-2">
                                                                            <div>
                                                                                <span className="text-gray-600">Marque: </span>
                                                                                <span className="font-medium">{entretien.details.marque}</span>
                                                                            </div>
                                                                            <div>
                                                                                <span className="text-gray-600">Viscosité: </span>
                                                                                <span className="font-medium">{entretien.details.viscosite}</span>
                                                                            </div>
                                                                        </div>
                                                                        <div className="flex flex-wrap gap-3 text-xs">
                                                                            {entretien.details.filtreAir && (
                                                                                <span className="inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800">
                                                                                    <i className="fas fa-wind mr-1"></i>
                                                                                    Filtre air
                                                                                </span>
                                                                            )}
                                                                            {entretien.details.filtreHuile && (
                                                                                <span className="inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800">
                                                                                    <i className="fas fa-oil-can mr-1"></i>
                                                                                    Filtre huile
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                {entretien.notes && (
                                                                    <div>
                                                                        <p className="text-xs text-gray-500">Notes:</p>
                                                                        <p className="text-gray-700 text-sm">{entretien.notes}</p>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="bg-white rounded-lg card p-8 md:p-12 text-center">
                                                <i className="fas fa-history text-gray-400 text-3xl md:text-4xl mx-auto mb-3"></i>
                                                <p className="text-gray-600 text-sm md:text-base">Aucun entretien trouvé</p>
                                                <p className="text-gray-500 text-xs mt-2">
                                                    {entretiens.length === 0 
                                                        ? "Commencez par ajouter votre premier entretien" 
                                                        : "Aucun entretien correspond à vos critères de recherche"}
                                                </p>
                                                {entretiens.length === 0 && (
                                                    <button
                                                        onClick={() => setCurrentView('ajout')}
                                                        className="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                                    >
                                                        Ajouter un entretien
                                                    </button>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </AnimatePresence>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>